name: release
on:
    release:
        types: [published]
jobs:
    publish:
        name: Publish to GitHub Pages
        runs-on: ubuntu-20.04
        steps:
            - name: Clone repository
              uses: actions/checkout@v2

            - name: Install Python
              uses: actions/setup-python@v2
              with:
                  python-version: 3.9
                  architecture: 'x64'

            - name: Install dependencies
              run: |
                  python -m pip install --upgrade pip
                  pip install --no-cache-dir jsonschema

            - name: Run before release scripts
              run: |
                  ls ${{ github.workspace }}/website/ci/release | xargs python3

            - name: Deploy to GitHub Pages
              run: | # dear god I hope this works
                  git config user.name github-actions
                  git config user.email github-actions@github.com
                  mv ./website/* .
                  git stash
                  git fetch origin
                  git checkout -b gh-pages origin/gh-pages
                  git merge --strategy-option=ours --no-commit stash
                  git add .
                  git commit -m "Deploy to GitHub Pages"
                  git push
